{% extends 'base.html' %}
{% load static %}
{% load form_extras %}

{% block title %}Cadastrar Manutenção Terceiro{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="py-5 text-white" style="background-image: linear-gradient(rgba(255, 152, 0, 0.5), rgba(255, 152, 0, 0.5)), url('{% static 'images/aurora_coop_castro.jpg' %}'); background-size: cover; background-position: center; background-repeat: no-repeat; position: relative;">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white">Home</a></li>
                        <li class="breadcrumb-item active text-white" aria-current="page">Manutenção Terceiro</li>
                        <li class="breadcrumb-item active text-white" aria-current="page">Cadastrar</li>
                    </ol>
                </nav>
                <h1 class="display-4 fw-bold mt-3">Cadastrar Manutenção Terceiro</h1>
                <p class="lead">Preencha os dados para cadastrar uma nova manutenção de terceiro</p>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="py-5">
    <div class="container">
        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-plus-circle me-2"></i>Dados da Manutenção Terceiro
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Aviso sobre campos obrigatórios -->
                        <div class="alert alert-info mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Campos obrigatórios:</strong> Os campos marcados com <span class="text-danger">*</span> são obrigatórios e devem ser preenchidos.
                        </div>
                        
                        <form method="post" action="{% url 'cadastrar_manutencao_terceiro' %}" id="manutencaoForm">
                            {% csrf_token %}
                            
                            <!-- Informações Principais -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-2 mb-3">
                                        <i class="fas fa-info-circle me-2"></i>Informações Principais
                                    </h6>
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label for="{{ form.titulo.id_for_label }}" class="form-label">
                                        {{ form.titulo.label }}
                                        {% if form.titulo|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.titulo }}
                                    {% if form.titulo.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.titulo.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Título descritivo da manutenção{% if form.titulo|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.empresa.id_for_label }}" class="form-label">
                                        {{ form.empresa.label }}
                                        {% if form.empresa|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.empresa }}
                                    {% if form.empresa.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.empresa.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Nome da empresa responsável pela manutenção{% if form.empresa|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.os.id_for_label }}" class="form-label">
                                        {{ form.os.label }}
                                        {% if form.os|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.os }}
                                    {% if form.os.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.os.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Número da Ordem de Serviço{% if form.os|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.pedidodecompra.id_for_label }}" class="form-label">
                                        {{ form.pedidodecompra.label }}
                                        {% if form.pedidodecompra|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.pedidodecompra }}
                                    {% if form.pedidodecompra.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.pedidodecompra.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Número do Pedido de Compra{% if form.pedidodecompra|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.requisicaodecompra.id_for_label }}" class="form-label">
                                        {{ form.requisicaodecompra.label }}
                                        {% if form.requisicaodecompra|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.requisicaodecompra }}
                                    {% if form.requisicaodecompra.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.requisicaodecompra.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Número da Requisição de Compra{% if form.requisicaodecompra|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                            </div>

                            <!-- Máquina e Tipo -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-2 mb-3">
                                        <i class="fas fa-cog me-2"></i>Máquina e Tipo
                                    </h6>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.maquina.id_for_label }}" class="form-label">
                                        {{ form.maquina.label }}
                                        {% if form.maquina|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.maquina }}
                                    {% if form.maquina.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.maquina.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Selecione a máquina relacionada{% if form.maquina|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.tipo.id_for_label }}" class="form-label">
                                        {{ form.tipo.label }}
                                        {% if form.tipo|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.tipo }}
                                    {% if form.tipo.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.tipo.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Tipo de manutenção{% if form.tipo|is_required %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                            </div>

                            <!-- Relacionamentos -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-2 mb-3">
                                        <i class="fas fa-link me-2"></i>Relacionamentos
                                    </h6>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.manutentor.id_for_label }}" class="form-label">
                                        {{ form.manutentor.label }}
                                        {% if form.manutentor|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.manutentor }}
                                    {% if form.manutentor.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.manutentor.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Manutentor responsável{% if not form.manutentor|is_required %} <span class="text-muted">(opcional)</span>{% else %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.os_importada.id_for_label }}" class="form-label">
                                        {{ form.os_importada.label }}
                                        {% if form.os_importada|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.os_importada }}
                                    {% if form.os_importada.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.os_importada.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">OS importada relacionada{% if not form.os_importada|is_required %} <span class="text-muted">(opcional)</span>{% else %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                            </div>

                            <!-- Data e Descrição -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-2 mb-3">
                                        <i class="fas fa-calendar me-2"></i>Data e Descrição
                                    </h6>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.data.id_for_label }}" class="form-label">
                                        {{ form.data.label }}
                                        {% if form.data|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.data }}
                                    {% if form.data.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.data.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Data e hora da manutenção{% if not form.data|is_required %} <span class="text-muted">(opcional)</span>{% else %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label for="{{ form.descricao.id_for_label }}" class="form-label">
                                        {{ form.descricao.label }}
                                        {% if form.descricao|is_required %}<span class="text-danger">*</span>{% endif %}
                                    </label>
                                    {{ form.descricao }}
                                    {% if form.descricao.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ form.descricao.errors|first }}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Descrição detalhada da manutenção{% if not form.descricao|is_required %} <span class="text-muted">(opcional)</span>{% else %} <span class="text-danger">(obrigatório)</span>{% endif %}</div>
                                </div>
                            </div>

                            <!-- Botões -->
                            <div class="d-flex justify-content-between mt-4">
                                <a href="{% url 'home' %}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                    <i class="fas fa-save me-2"></i>Salvar Manutenção Terceiro
                                </button>
                                <button type="button" class="btn btn-danger ms-2" onclick="document.getElementById('manutencaoForm').submit(); console.log('FORCED SUBMIT');">
                                    FORÇAR ENVIO
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Minimal JavaScript - just log, never prevent
console.log('=== MANUTENCAO TERCEIRO SCRIPT LOADED ===');

window.addEventListener('load', function() {
    console.log('Page loaded');
    const form = document.getElementById('manutencaoForm');
    console.log('Form found:', !!form);
    
    if (form) {
        console.log('Form action:', form.action);
        console.log('Form method:', form.method);
        
        // Simple submit handler - just log, never prevent
        form.addEventListener('submit', function(e) {
            console.log('=== FORM SUBMITTING ===');
            // Don't prevent - let it submit
        }, false);
    }
});
</script>
{% endblock %}

